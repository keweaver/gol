<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
        <canvas id="canvas" width="600" height="400" style="border:1px solid black;">display</canvas>
        <p id="text">test</p>
    </body>
    <script>
    
        class Cell {
            constructor(i, j, alive, ctx) {
                this.i = i;
                this.j = j; 
                this.alive = alive;
                this.ctx = ctx;
                this.cell_width = 10;
            }

            draw() {
                if (this.alive) {
                    this.ctx.fillStyle = 'black';

                    this.ctx.fillRect(this.i * 10, this.j  * 10, this.cell_width, this.cell_width);
                }
                else {
                    this.ctx.fillStyle = 'white';
                    this.ctx.fillRect(this.i * 10, this.j  * 10, this.cell_width, this.cell_width);

                }
            }

            
        }
    
        class Board {
            constructor(id) {
                this.canvas = document.getElementById(id);
                this.cell_width = 10;
                this.width = this.canvas.width / this.cell_width;
                this.height = this.canvas.height / this.cell_width; 

                this.ctx = canvas.getContext('2d');
                this.cells = [];

                this.init_board();
                window.requestAnimationFrame(() => this.play_game());
            }

            init_board() {
                for(let i = 0; i < this.width; i++) {
                    let cur_row = [];
                    for(let j = 0; j < this.height; j++) {
                        let alive = Math.random();
                        let cell = new Cell(i, j, alive < 0.5, this.ctx);
                        cur_row.push(cell);
                        cell.draw(); 
                    }
                    this.cells.push(cur_row);
                }
                //2D ARRAY IS WORKING :) 
                //document.getElementById("text").innerHTML =  this.cells[0][0];
            }

            update(cell) {
                //given a cell, use GOL rules to update status

                let neighbors = this.retrieve_neighbors(cell.i, cell.j);

                let live = neighbors.filter(Boolean).length;
                
                if (cell.alive) {
                    //fewer than two live neighbours dies: 
                    if (live < 2) {
                        cell.alive = false; 
                    }
                    //two or three live neighbors lives: 
                    else if ((live == 2) || (live == 3)) {
                        cell.alive = true; 
                    }
                    //more than three live neighbors dies:
                    else {
                        cell.alive = false; 
                    }
                }
                else {
                    //cell is currentl dead
                    if (live == 3) {
                        cell.alive = true; 
                    }
                }
            }

            retrieve_neighbors(i, j) {
                document.getElementById("text").innerHTML =  i + " " + j + " " + this.height;


                let neighbors = [];

                //if there are cells to the left..
                if (i > 0) {
                    //get the cell to the left
                    neighbors.push(this.cells[i - 1][j]);
                    if (j > 0) {
                        //get the cell to the upper left 
                        neighbors.push(this.cells[i-1][j-1].alive);
                    }
                    if (j < this.height - 1) {
                        //get the cell to the lower left 
                        neighbors.push(this.cells[i-1][j+1].alive)
                    }
                }
                if (i < this.width - 1) {
                    //get the cell to the right...
                    neighbors.push(this.cells[i + 1][j].alive);
                    if (j > 0) {
                        //get cell to upper right...
                        neighbors.push(this.cells[i + 1][j - 1].alive);
                    }
                    if (j < this.height - 1) {
                        neighbors.push(this.cells[i + 1][j + 1].alive);
                    }
                }
                if (j > 0) {
                    //get the cell directl above
                    neighbors.push(this.cells[i][j-1].alive);
                }
                if (j < this.height - 1) {
                    //get the cell directl below 
                    neighbors.push(this.cells[i][j+1].alive);
                }

                return neighbors; 
            }

            play_game() {
                //update each cell's status 

                this.cells.forEach(row => {
                    row.forEach(cell => {
                        this.update(cell);
                    });
                });

                this.cells.forEach(row => {
                    row.forEach(cell => {
                        cell.draw();
                    });
                });

                setTimeout( () => {
                  window.requestAnimationFrame(() => this.play_game());
                 }, 100)
            }

        }

        let game = new Board('canvas');
    </script>
</html>